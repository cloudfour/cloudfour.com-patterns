import { Meta, Heading, Subheading, Story, ColorPalette, ColorItem } from '@storybook/addon-docs/blocks';
import groupBy from 'lodash/groupBy';
import startCase from 'lodash/startCase';
const collator = new Intl.Collator(undefined, {
  numeric: true,
  sensitivity: 'base'
});
const tokenContext = require.context('.', false, /^\.\/[^_].+\.yml$/);
const tokenDocData = {};
tokenContext.keys().forEach(tokenPath => {
  const fileData = tokenContext(tokenPath);
  const sorted = Object.values(fileData).sort((a, b) => collator.compare(a.tokenName, b.tokenName));
  const organized = groupBy(sorted, 'category');
  Object.keys(organized).forEach(category => {
    organized[category] = groupBy(organized[category], 'type');
  });
  tokenDocData[tokenPath] = organized;
});
const tokenDocs = Object.keys(tokenDocData).map(tokenPath => {
  const file = tokenDocData[tokenPath];
  const fileHeading = startCase(tokenPath.replace(/^\.\/([^_].+)\.yml$/g, '$1'));
  const categoryKeys = Object.keys(file);
  const categories = categoryKeys.map(categoryKey => {
    const categoryData = file[categoryKey];
    const typeKeys = Object.keys(categoryData);
    let categoryHeading;
    if (categoryKeys.length > 1) {
      categoryHeading = <Subheading>{startCase(categoryKey)}</Subheading>
    }
    const types = typeKeys.map(typeKey => {
      const typeData = categoryData[typeKey];
      const tokens = Object.values(typeData);
      let typeHeading, typeDocs;
      if (typeKeys.length > 1) {
        const typeName = startCase(typeKey);
        if (categoryHeading) {
          typeHeading = <h3>{typeName}</h3>;
        } else {
          typeHeading = <Subheading>{typeName}</Subheading>;
        }
      }
      if (categoryKey.indexOf('color') !== -1) {
        const tokenColors = tokens.map(token => {
          return <ColorItem
            title={token.sassName}
            colors={[token.value]}
          />
        });
        typeDocs = <ColorPalette>{tokenColors}</ColorPalette>;
      } else {
        const tokenRows = tokens.map(token => {
          return <tr>
            <td>{token.sassName}</td>
            <td>{token.value}</td>
          </tr>
        });
        typeDocs = <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            {tokenRows}
          </tbody>
        </table>;
      }
      return <div>
        {typeHeading}
        {typeDocs}
      </div>
    });
    return <div>
      {categoryHeading}
      {types}
    </div>
  });
  return <div>
    <Heading>{fileHeading}</Heading>
    {categories}
  </div>;
});

<Meta title="Design Tokens"/>

# Design Tokens

<div>{tokenDocs}</div>
