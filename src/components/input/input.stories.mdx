import { Story, Preview, Meta } from '@storybook/addon-docs/blocks';
import {
  withKnobs,
  text,
  number,
  boolean,
  select,
} from '@storybook/addon-knobs';
import { useEffect } from '@storybook/client-api';
import textDemo from './demo/example.twig';
import selectDemo from './demo/select.twig';
import './demo/styles.scss';
import { createElasticTextArea } from './input.ts';

<Meta title="Components/Input" decorators={[withKnobs]} />

# Input

The `c-input` class styles text and text-like form elements in a consistent way. It works great with an adjacent [button component](/?path=/story/components-button--elements).

<Preview>
  <Story name="Text Elements" height="200px">
    {textDemo({
      type: select('type', ['text', 'email', 'search', 'date', 'textarea']),
      value: text('value'),
      placeholder: text('placeholder', 'Placeholder text…'),
      id: text('id', 'demo-input'),
      readonly: boolean('readonly'),
      disabled: boolean('disabled'),
    })}
  </Story>
</Preview>

You can also add `c-input` to `<select>` elements, in which case you’ll get a nifty iconographic affordance. The `multiple` attribute is not supported.

<Preview>
  <Story name="Select Element" height="200px">
    {selectDemo({
      id: text('id', 'demo-select'),
      disabled: boolean('disabled'),
    })}
  </Story>
</Preview>

## Elastic textarea

Add `js-elastic-textarea` to a `<textarea>` element (and follow the [JS usage notes](#javascript-usage)) to have it expand as the user types more than will fit.

If the `rows` attribute is set, it will be used as the minimum height.

<Preview>
  <Story name="Elastic Textarea" height="350px">
    {() => {
      // Use storybook hooks to trigger JS after story renders
      // @see https://github.com/storybookjs/storybook/issues/7786
      useEffect(() => {
        createElasticTextArea(document.querySelector('.js-elastic-textarea'));
      }, []);
      return textDemo({
        type: select(
          'type',
          ['text', 'email', 'search', 'date', 'textarea'],
          'textarea'
        ),
        value: text('value', 'a\nb\nc\nd\ne'),
        placeholder: text('placeholder', 'Placeholder text…'),
        rows: number('rows', '2'),
        id: text('id', 'demo-elastic'),
        class: text('class', 'js-elastic-textarea'),
      });
    }}
  </Story>
</Preview>

### JavaScript Usage

Once you have added the `js-elastic-textarea` class to your `textarea` element, you'll also need to add some JavaScript that runs after the page loads, like so:

```js
// Select all elastic textarea elements, run create function on each
const elasticTextAreas = [
  ...document.querySelectorAll('.js-elastic-textarea'),
].map((textarea) => {
  return createElasticTextArea(textarea);
});
```

The `createElasticTextArea` function adds an event listener to the `textarea`, allowing it to respond to user input by growing or shrinking as needed. It returns an object containing a `destroy()` method, if you need to remove the event listener.

```js
// Remove event listeners from the elastic text areas
elasticTextAreas.forEach((textarea) => {
  textarea.destroy();
});
```
